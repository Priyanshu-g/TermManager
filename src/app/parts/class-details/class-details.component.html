<p-table
  [value]="config.data.tasks"
  selectionMode="single"
  [(selection)]="mainTask"
  [metaKeySelection]="false"
  (onRowSelect)="selectTask($event)" 
  (onRowUnselect)="unselectTask($event)" 
>
  <ng-template pTemplate="caption" class="zero">
    <div class="flex justify-content-between zero align-items-center gap">
      <div>Current Average: {{ classCurrentAverage() }}</div>
      <div class="minor-caption earn zero">
        Assuming you earn &nbsp;&nbsp;&nbsp;
      </div>
      <div class="minor-caption need zero">
        You will need 
      </div>
      <div>
        Goal:
        <p-inputNumber
          [(ngModel)]="goal"
          inputId="minmax"
          mode="decimal"
          [min]="0"
          [max]="100"
          [showButtons]="true"
          [suffix]="'%'"
        />
      </div>
    </div>
  </ng-template>
  <ng-template pTemplate="header">
    <tr>
      <th pSortableColumn="class">Class</th>
      <th pSortableColumn="activity">Activity</th>
      <th pSortableColumn="releaseDate">Release</th>
      <th pSortableColumn="dueDate">Due</th>
      <th pSortableColumn="weight">Weight</th>
      <th pSortableColumn="earned">Earned</th>
      <th pSortableColumn="completed">Completed</th>
      <th pSortableColumn="notes">Notes</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-task>
    @if (task.earned){
    <tr>
      <td>{{ task.class }}</td>
      <td>{{ task.activity }}</td>
      <td>{{ task.releaseDate | date : "EEE, MMM d" }}</td>
      <td>{{ task.dueDate | date : "EEE, MMM d" }}</td>
      <td>{{ task.weight }}%</td>
      <td>{{ task.earned }}%</td>
      <td>{{ task.completed }}</td>
      <td>{{ task.notes }}</td>
    </tr>
    } @else if (mainTask){
      @if (task === mainTask) {
        <tr [pSelectableRow]="task">
            <td>{{ task.class }}</td>
            <td>{{ task.activity }}</td>
            <td>{{ task.releaseDate | date : "EEE, MMM d" }}</td>
            <td>{{ task.dueDate | date : "EEE, MMM d" }}</td>
            <td>{{ task.weight }}%</td>
            <td class="need">{{ estimate }}</td>
            <td>{{ task.completed }}</td>
            <td>{{ task.notes }}</td>
        </tr>
      } @else {
        <tr>
            <td>{{ task.class }}</td>
            <td>{{ task.activity }}</td>
            <td>{{ task.releaseDate | date : "EEE, MMM d" }}</td>
            <td>{{ task.dueDate | date : "EEE, MMM d" }}</td>
            <td>{{ task.weight }}%</td>
            <td [pEditableColumn]="task.estimate" pEditableColumnField="estimate">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <p-inputNumber
                    [showButtons]="true" 
                    [(ngModel)]="task.estimate"
                    required
                    [min]="0"
                    [max]="100"
                    suffix="%"
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  <div class="earn">{{ task.estimate }}%</div>
                </ng-template>
              </p-cellEditor>
            </td>
            <td>{{ task.completed }}</td>
            <td>{{ task.notes }}</td>
        </tr>
      }
    } @else {
    <tr [pSelectableRow]="task">
      <td>{{ task.class }}</td>
      <td>{{ task.activity }}</td>
      <td>{{ task.releaseDate | date : "EEE, MMM d" }}</td>
      <td>{{ task.dueDate | date : "EEE, MMM d" }}</td>
      <td>{{ task.weight }}%</td>
      <td><b> CHOOSE THIS TASK </b></td>
      <td>{{ task.completed }}</td>
      <td>{{ task.notes }}</td>
    </tr>
    }
  </ng-template>
</p-table>
